<!DOCTYPE html>
<html>
<title>Saratoga Cloud Logs Analyzer</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-teal.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<body>

<!-- Side Navigation -->
<nav class="w3-sidebar w3-bar-block w3-card w3-animate-left w3-center" style="display:none" id="mySidebar">
  <h1 class="w3-xxxlarge w3-text-theme">Side Navigation</h1>
  <button class="w3-bar-item w3-button" onclick="w3_close()">Close <i class="fa fa-remove"></i></button>
  <!--a href="#" class="w3-bar-item w3-button">Link 1</a-->
</nav>

<!-- Header -->
<header class="w3-container w3-theme w3-padding" id="myHeader">
  <i onclick="w3_open()" class="fa fa-bars w3-xlarge w3-button w3-theme"></i> 
  <div class="w3-center">
  <h4>Saratoga CLA Demonstration</h4>
  <h1 class="w3-xxxlarge w3-animate-bottom">AWS Logs Analyzer</h1>
    <div class="w3-padding-32">
      <a href="#getstart"><button class="w3-btn w3-xlarge w3-black w3-hover-purple">
        Get Started</button></a>
    </div>
  </div>
</header>

<div class="w3-container w3-card">
  <div class="w3-justify">
    <h3>Input</h3>
    <br>
    <p class="w3-center">This demonstration uses sample data. 
      The software program will not fetch all the log files, but a sample of them. 
      The different log files are from <b>AWS-cloudTrail</b> and <b>AWS-config</b>.
      Logs vary in structure and data. Generally, no two log files are the same.
    </p>
    <form class="w3-container" id="iform" name="iform">
      <label class="w3-text-blue"><b>Key</b></label>
      <input class="w3-input w3-border" id="ikey" type="text" "required">
      <p><b>Examples of search:</b> accountId, accessKeyId, principalId, arn, userName, awsRegion, recipientAccountId,
      creationDate, sourceIPAddress, eventName, eventSource, eventTime, vpcId, subnetIdentifier, dBInstanceArn,
      resourceName, resourceId. This list is by no means exhaustive.</p>
      <label class="w3-text-blue"><b>Search For</b></label>
      <input class="w3-input w3-border" id="isearch" type="text" placeholder="userName" "required" />
      <br />
      <button class="w3-btn w3-black w3-hover-purple" id="ivsearch">Search</button>
    </form>
  </div>
  <br />
</div>

<div class="w3-container w3-card w3-padding w3-half">
    <div id="piechart"></div>
</div>

<div class="w3-container w3-card w3-padding w3-half">
  <div id="barchart"></div>
</div>

<div class="w3-container w3-card w3-padding">
  <div id="result"></div>
</div>

<div class="w3-row-padding w3-center w3-margin-top" id="getstart">
<h1>Getting Started</h1>  
<div class="w3-third">
  <div class="w3-card w3-container" style="min-height:460px">
  <h3>(1) List Log Clump Files</h3><br>
  <i class="fa fa-desktop w3-margin-bottom w3-text-theme" style="font-size:120px"></i>
  <p>Fetch gzip json details from s3 bucket</p>
  </div>
</div>

<div class="w3-third">
  <div class="w3-card w3-container" style="min-height:460px">
  <h3>(2) Fetch Log Clump Files</h3><br>
  <i class="fa fa-superpowers w3-margin-bottom w3-text-theme" style="font-size:120px"></i>
  <p>Fetch gzip json details from s3 bucket, unzip</p>
  </div>
</div>

<div class="w3-third">
  <div class="w3-card w3-container" style="min-height:460px">
  <h3>(3) Clean, Decode Log Clumps</h3><br>
  <i class="fa fa-archive w3-margin-bottom w3-text-theme" style="font-size:120px"></i>
  <p>Rearrange JSON clumps as JSONs</p>
  </div>
</div>
</div>
<br>

<!-- Footer -->
<footer class="w3-container w3-theme-dark w3-padding-16">
  <h3>Demonstration</h3>
  <p>Powered by Cloudbelow and Xpertech. &COPY; Copyright 2018-19 Cloudbelow.org, xpertech.com. All rights reserved.</p>
</footer>

<!-- Script for Sidebar, Tabs, Accordions, Progress bars and slideshows -->
<script>
// Side navigation
function w3_open() {
    var x = document.getElementById("mySidebar");
    x.style.width = "100%";
    x.style.fontSize = "40px";
    x.style.paddingTop = "10%";
    x.style.display = "block";
}
function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
}
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
  const splitAt = index => x => [x.slice(0, index), x.slice(index)];
  $("#iform").submit(function (e) {
    e.preventDefault();
  });

  $(document).ready(function () {
    $("#ivsearch").click(function () {
      $("#result").html('');
        let keydata = $("#isearch").val();
        $.ajax({
          type: 'POST',
          url: 'analyzelogs/',
          data: JSON.stringify({
            'search': keydata
          }),
          contentType: "application/json; charset=utf-8",
          traditional: true,
          success: function (outdata) {
            // console.log('data', data);
            let newData = [];
            // $("#result").html('<h2>Data</h2><pre>'+JSON.stringify(outdata, null, 2)+'</pre>');
            for (var i=0; i<outdata.length; i++) {
              newData.push([outdata[i].key, outdata[i].value]);
            }
            $("#result").html('<h2>Data</h2><pre>'+JSON.stringify(newData, null, 2)+'</pre>');
            drawBothCharts(newData);
          }
        })
      });
  });
</script>

<script type="text/javascript">
  // Load google charts
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawBothCharts);
  
  // Draw the chart and set the chart values
  function drawBothCharts(gdata) {
    // console.log('gdata', gdata);
    if (gdata == undefined || gdata == []) {
      console.log('concocting data');
      gdata = [['Results','Count'],['Data', 100]];
      var data = google.visualization.arrayToDataTable(gdata);
      var options = {'title':'Search Results', 'width':400, 'height':300};
      var chart = new google.visualization.PieChart(document.getElementById('piechart'));
      // chart.draw(data, options);
    } else {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Search');
      data.addColumn('number', 'Occurences');
      data.addRows(gdata);
      // var data = google.visualization.arrayToDataTable(gdata);
      var pie_options = {'title':'Search Results', 'width':400, 'height':300};
      var pie_chart = new google.visualization.PieChart(document.getElementById('piechart'));
      pie_chart.draw(data, pie_options);

      var barchart_options = {title:'Occurences', width:400, height:300, legend: 'none',
          chart: { title: 'Occurences',
                   subtitle: 'Search Results' },};
      var barchart = new google.visualization.BarChart(document.getElementById('barchart'));
      barchart.draw(data, barchart_options);
    }
  }
</script>

</body>
</html>
